<!-- Tutorial Overlay -->
<app-tutorial *ngIf="showTutorial" (finishTutorial)="onFinishTutorial()" (skipTutorial)="onSkipTutorial()">
</app-tutorial>

<!-- Toolbar with Exit & Back -->
<mat-toolbar [ngClass]="'level-' + currentLevel">
  Memory Game - Level {{currentLevel}} | Moves: {{moves}} | Score: {{score}} | Time: {{timeLeft}}s
  <span class="spacer"></span>
  <button matButton color="accent" (click)="restart()">
    <mat-icon>arrow_back</mat-icon> Back
  </button>
  <button mat-button color="accent" *ngIf="!paused" (click)="pauseGame()">
    <mat-icon>pause</mat-icon> Pause
  </button>
  <button mat-button color="primary" *ngIf="paused" (click)="resumeGame()">
    <mat-icon>play_arrow</mat-icon> Resume
  </button>
  <button mat-icon-button (click)="openSettings()" aria-label="Settings">
    <mat-icon>settings</mat-icon>
  </button>
  <button mat-button color="warn" (click)="exitGame()">
    <mat-icon>exit_to_app</mat-icon>Exit Game</button>
</mat-toolbar>


<!-- Start Screen -->
<div *ngIf="!gameStarted && !gameOver && !showTutorial" class="start-screen">
  <mat-card class="start-card">
    <h1>Memory Game</h1>
    <p>Match all pairs before time runs out!</p>
    <p>Levels increase difficulty. Try to get the highest score!</p>
    <button mat-raised-button color="primary" (click)="startGame()">Start Game</button>
  </mat-card>
</div>

<!-- Game Container -->
<div *ngIf="gameStarted && !showTutorial" class="game-container">
  <!-- Timer Progress Bar -->
  <mat-progress-bar mode="determinate" [value]="(timeLeft / level.time) * 100"></mat-progress-bar>

  <!-- Card Grid -->
  <mat-grid-list [cols]="gridCols()" rowHeight="100px" gutterSize="10px">
    <mat-grid-tile *ngFor="let card of cards">
      <mat-card class="card" [class.flipped]="card.flipped || card.matched" (click)="flipCard(card)">
        <div class="front">{{ card.value }}</div>
        <div class="back">‚ùì</div>
      </mat-card>
    </mat-grid-tile>
  </mat-grid-list>

  <div *ngIf="levelComplete" class="level-complete">
    <mat-card>
      <h2>Level {{currentLevel - 1}} Complete!</h2>
      <p>Get ready for Level {{currentLevel}}</p>
      <button mat-raised-button color="primary" (click)="continueLevel()">Continue</button>
    </mat-card>
  </div>

  <!-- Pause Overlay -->
  <div *ngIf="paused" class="pause-overlay">
    <mat-card>
      <h2>Game Paused</h2>
      <button mat-raised-button color="primary" (click)="resumeGame()">Resume</button>
      <button mat-raised-button color="accent" (click)="restart()">Restart Level</button>
      <button mat-raised-button color="warn" (click)="exitGame()">Exit</button>
    </mat-card>
  </div>
  <!-- Controls -->
  <div class="controls">
    <button mat-raised-button color="accent" (click)="restart()">Restart Level</button>
  </div>
</div>

<!-- Game Over Screen -->
<div *ngIf="gameOver && !showTutorial" class="game-over">
  <mat-card>
    <h2>Game Over!</h2>
    <p>Your Score: {{score}}</p>
    <button mat-raised-button color="primary" (click)="restart()">Play Again</button>
  </mat-card>
</div>